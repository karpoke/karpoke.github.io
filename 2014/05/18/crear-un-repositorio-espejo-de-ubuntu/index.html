<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Nacho Cano" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="apache2, apt, apt-mirror, repositorio espejo, ubuntu, admin, " />

<meta property="og:title" content="Crear un repositorio espejo de Ubuntu "/>
<meta property="og:url" content="https://karpoke.ignaciocano.com/2014/05/18/crear-un-repositorio-espejo-de-ubuntu/" />
<meta property="og:description" content="Si tenemos un gran número de equipos con Ubuntu en nuestra LAN, nos puede interesar tener un espejo local del repositorio de paquetes de Ubuntu. Una diferencia entre esta opción y utilizar un proxy/caché de paquetes es que, en el primer caso, ya tendremos todos los paquetes disponibles cuando …" />
<meta property="og:site_name" content="Karpoke" />
<meta property="og:article:author" content="Nacho Cano" />
<meta property="og:article:published_time" content="2014-05-18T21:48:00+02:00" />
<meta name="twitter:title" content="Crear un repositorio espejo de Ubuntu ">
<meta name="twitter:description" content="Si tenemos un gran número de equipos con Ubuntu en nuestra LAN, nos puede interesar tener un espejo local del repositorio de paquetes de Ubuntu. Una diferencia entre esta opción y utilizar un proxy/caché de paquetes es que, en el primer caso, ya tendremos todos los paquetes disponibles cuando …">

        <title>Crear un repositorio espejo de Ubuntu  · Karpoke
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/admonition.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/custom.css" media="screen">

        <link href="https://karpoke.ignaciocano.com/feeds/all/rss.xml" type="application/rss+xml" rel="alternate" title="Karpoke - Full RSS Feed" />
        <link href="https://karpoke.ignaciocano.com/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Karpoke - RSS Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://karpoke.ignaciocano.com/"><span class=site-name>Karpoke</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://karpoke.ignaciocano.com
                                    >Home</a>
                                </li>
                                <li ><a href="https://karpoke.ignaciocano.com/whoami/">Who am I</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/categorias/">Categories</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/etiquetas/">Tags</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/archivos/">Archives</a></li>
                                <li><form class="navbar-search" action="https://karpoke.ignaciocano.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://karpoke.ignaciocano.com/2014/05/18/crear-un-repositorio-espejo-de-ubuntu/">
                Crear un repositorio espejo de Ubuntu
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>Si tenemos un gran número de equipos con Ubuntu en nuestra LAN, nos
puede interesar tener un espejo local del repositorio de paquetes de
Ubuntu. Una diferencia entre esta opción y <a href="https://karpoke.ignaciocano.com/2014/05/17/cache-de-paquetes-descargados-en-ubuntu-trusty-tahr/" title="Caché de paquetes descargados en Ubuntu Trusty Tahr">utilizar un <em>proxy/caché</em> de
paquetes</a> es que, en el primer caso, ya tendremos todos los paquetes
disponibles cuando los vayamos a necesitar.</p>
<h2>Clonar el repositorio en local</h2>
<p>Para crear un repositorio local, podemos usar el comando <code>apt-mirror</code>,
disponible en los repositorios. Una vez instalado, podemos editar el
fichero de configuración en <code>/etc/apt/mirror.list</code> para, por ejemplo,
cambiar el directorio donde se guardarán los paquetes (por defecto
<code>/var/spool/apt-mirror</code>), añadir o eliminar fuentes a incluir en el
repositorio, etc. Con las fuentes por defecto, hay que tener en cuenta
que serán necesarios más de 100 GB para alojar el repositorio. Si
optásemos sólo por incluir el "main", se queda en 10 GB.</p>
<p>Luego, lo ejecutamos:</p>
<p>```bash
$ sudo apt-mirror</p>
<p>Downloading 162 index files using 20 threads...
Begin time: Sat May 17 12:31:22 2014
[20]... [19]... [18]... [17]... [16]... [15]... [14]... [13]... [12]... [11]... [10]... [9]... [8]... [7]... [6]... [5]... [4]... [3]... [2]... [1]... [0]...
End time: Sat May 17 12:32:02 2014</p>
<p>Processing tranlation indexes: [TTT]</p>
<p>Downloading 185 translation files using 20 threads...
Begin time: Sat May 17 12:32:02 2014
[20]... [19]... [18]... [17]... [16]... [15]... [14]... [13]... [12]... [11]... [10]... [9]... [8]... [7]... [6]... [5]... [4]... [3]... [2]... [1]... [0]...
End time: Sat May 17 12:33:13 2014</p>
<p>Processing indexes: [SSSPPP]</p>
<p>110.1 GiB will be downloaded into archive.
Downloading 111238 archive files using 20 threads...
Begin time: Sat May 17 12:33:28 2014
[20]...
```</p>
<h3>Actualizar el repositorio local</h3>
<p>Para mantener el repositorio actualizado, bastará editar el fichero de
configuración del <code>cron</code> para que se ejecute periódicamente:</p>
<p><code>bash
$ sudo vim /etc/cron.d/apt-mirror
0 4 * * * apt-mirror /usr/bin/apt-mirror &gt; /var/spool/apt-mirror/var/cron.log</code></p>
<h3>Actualizaciones del propio servidor</h3>
<p>Si queremos que el propio servidor utilice el espejo local, deberemos
cambiar las fuentes del <code>/etc/apt/sources.list</code> para que, en lugar de
consultar el repositorio remoto, consulte el fichero local. Algo, así:</p>
<p>```bash</p>
<h1>deb http://archive.ubuntu.com/ubuntu/ trusty main universe</h1>
<p>deb file:/var/spool/apt-mirror/mirror/archive.ubuntu.com/ubuntu trusty main universe
```</p>
<h3>Configurar el servidor web</h3>
<p>Por último, sólo queda que el repositorio sea accesible para los
clientes a través del servidor web. En este caso, crearemos un nuevo
<em>host</em> virtual para Apache2, por ejemplo,
<code>/etc/apache2/sites-available/deb.example.com.conf</code>:</p>
<p>```bash
ServerName deb.example.com
DocumentRoot /var/spool/apt-mirror/mirror/archive.ubuntu.com</p>
<p>Options Indexes FollowSymLinks MultiViews
AllowOverride Limit Options FileInfo Indexes
Require all granted</p>
<p>ErrorLog ${APACHE_LOG_DIR}/deb.example.com-error.log
CustomLog ${APACHE_LOG_DIR}/deb.example.com-access.log combined</p>
<h1>vim: syntax=apache ts=4 sw=4 sts=4 sr noet</h1>
<p>```</p>
<p>Lo activamos y reiniciamos apache:</p>
<p><code>bash
$ sudo a2ensite deb.example.com.conf
$ sudo apache2ctl configtest &amp;&amp; sudo apache2ctl graceful</code></p>
<p>Si todo ha ido bien, veremos dos directorios listados en la URL
http://deb.example.com/ubuntu/.</p>
<h3>Configuración de los clientes</h3>
<p>Para que el resto de equipos comiencen a utilizar el repositorio local,
deberemos editar el fichero de fuentes (<code>/etc/apt/sources.list</code>) y
sustituir las que había por las del repositorio que acabamos de crear:</p>
<p>```bash</p>
<h1>deb http://archive.ubuntu.com/ubuntu/ trusty main universe</h1>
<p>deb http://deb.example.com/ubuntu/ trusty main universe
```</p>
<p>Como comentario, las fuentes relativas a actualizaciones de seguridad
las dejaría como está, para que se sigan descargando desde los
repositorios originales:</p>
<p><code>bash
deb http://security.ubuntu.com/ubuntu trusty-security main restricted universe multiverse</code></p>
<p>Sólo resta actualizar la lista de paquetes disponibles:</p>
<p><code>bash
$ sudo aptitude update</code></p>
<h2>Referencias</h2>
<p>» <a href="http://popey.com/blog/2006/10/24/creating_an_ubuntu_repositoryespejowith_apt-mirror/" title="Creating an Ubuntu repository mirror with apt-mirror">Creating an Ubuntu repository mirror with apt-mirror</a></p>


            
            
            






            <hr/>
<section>
    <h2>Entradas relacionadas</h2>
<ul class="related-posts-list">
<li><a href="https://karpoke.ignaciocano.com/2011/05/25/localepurge/" title="localepurge">localepurge</a></li>
<li><a href="https://karpoke.ignaciocano.com/2012/04/12/apache2-y-mod_security-en-ubuntu-lucid-lynx-10-04/" title="Apache2 y mod_security en Ubuntu Lucid Lynx 10.04">Apache2 y mod_security en Ubuntu Lucid Lynx 10.04</a></li>
<li><a href="https://karpoke.ignaciocano.com/2012/12/15/subdominios-dinamicos-en-un-alojamiento-con-dominio-dinamico-en-ovh/" title="Subdominios dinámicos en un alojamiento con dominio dinámico en OVH">Subdominios dinámicos en un alojamiento con dominio dinámico en OVH</a></li>
<li><a href="https://karpoke.ignaciocano.com/2016/12/13/instalar-postgresql-9-6-en-ubuntu-16-04/" title="Instalar Postgresql 9.6 en Ubuntu 16.04">Instalar Postgresql 9.6 en Ubuntu 16.04</a></li>
<li><a href="https://karpoke.ignaciocano.com/2016/12/15/instalar-spotify-en-ubuntu-16-04/" title="Instalar Spotify en Ubuntu 16.04">Instalar Spotify en Ubuntu 16.04</a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://karpoke.ignaciocano.com/2014/05/17/cache-de-paquetes-descargados-en-ubuntu-trusty-tahr/" title="Previous: Caché de paquetes descargados en Ubuntu Trusty Tahr">Caché de paquetes descargados en Ubuntu Trusty Tahr</a></li>
                <li class="next-article"><a href="https://karpoke.ignaciocano.com/2014/05/23/script-injected-async-scripts-considered-harmful/" title="Next: Script-injected ”async scripts” considered harmful">Script-injected ”async scripts” considered harmful</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2014-05-18T21:48:00+02:00">May 18, 2014</time>
            <h4>Category</h4>
            <a class="category-link" href="https://karpoke.ignaciocano.com/categorias/#admin-ref">admin</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#apache2-ref">apache2
                    <span>3</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#apt-ref">apt
                    <span>5</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#apt-mirror-ref">apt-mirror
                    <span>1</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#repositorio-espejo-ref">repositorio espejo
                    <span>1</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#ubuntu-ref">ubuntu
                    <span>22</span>
</a></li>
            </ul>
<h4>Contacto</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/karpoke" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="/feeds/all/rss.xml" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </div>
        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        2010-2019 (cc) Contenido bajo licencia <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/es/">Creative Commons Reconocimiento-CompartirIgual</a>.
    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>