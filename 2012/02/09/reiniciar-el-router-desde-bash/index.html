<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Nacho Cano" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="comtrend, expect, ip, router, script, telnet, vr-3025u, yad, admin, " />

<meta property="og:title" content="Reiniciar el router desde el terminal "/>
<meta property="og:url" content="https://karpoke.ignaciocano.com/2012/02/09/reiniciar-el-router-desde-bash/" />
<meta property="og:description" content="De vez en cuando, necesitamos reiniciar nuestro router. Por ejemplo, para provocar un cambio de IP, si tenemos IP dinámica. Podemos acceder al panel de administración del router mediante el navegador, normalmente en el puerto 80 u 8080, aunque también es posible hacerlo a través de telnet, en el puerto …" />
<meta property="og:site_name" content="Karpoke" />
<meta property="og:article:author" content="Nacho Cano" />
<meta property="og:article:published_time" content="2012-02-09T21:36:00+01:00" />
<meta name="twitter:title" content="Reiniciar el router desde el terminal ">
<meta name="twitter:description" content="De vez en cuando, necesitamos reiniciar nuestro router. Por ejemplo, para provocar un cambio de IP, si tenemos IP dinámica. Podemos acceder al panel de administración del router mediante el navegador, normalmente en el puerto 80 u 8080, aunque también es posible hacerlo a través de telnet, en el puerto …">

        <title>Reiniciar el router desde el terminal  · Karpoke
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/admonition.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/custom.css" media="screen">

        <link href="https://karpoke.ignaciocano.com/feeds/all/rss.xml" type="application/rss+xml" rel="alternate" title="Karpoke - Full RSS Feed" />
        <link href="https://karpoke.ignaciocano.com/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Karpoke - RSS Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://karpoke.ignaciocano.com/"><span class=site-name>Karpoke</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://karpoke.ignaciocano.com
                                    >Home</a>
                                </li>
                                <li ><a href="https://karpoke.ignaciocano.com/whoami/">Who am I</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/categorias/">Categories</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/etiquetas/">Tags</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/archivos/">Archives</a></li>
                                <li><form class="navbar-search" action="https://karpoke.ignaciocano.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://karpoke.ignaciocano.com/2012/02/09/reiniciar-el-router-desde-bash/">
                Reiniciar el router desde el terminal
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>De vez en cuando, necesitamos reiniciar nuestro <em>router</em>. Por ejemplo,
para provocar un cambio de IP, si tenemos IP dinámica. Podemos acceder
al panel de administración del <em>router</em> mediante el navegador,
normalmente en el puerto 80 u 8080, aunque también es posible hacerlo a
través de telnet, en el puerto 22.</p>
<p>Para hacer más sencillo este trámite, utilizaremos un <em>script</em> que se
conecta por telnet al <em>router</em>, introduce el usuario y la contraseña y
lo reinicia mediante el comando <code>reboot</code>. Esto dependerá de cada modelo
de <em>router</em> en concreto, pero creo que funciona para un gran número. En
principio, no es posible apagarlo, sólo reiniciarlo.</p>
<p>El siguiente <em>script</em>, <code>router.sh</code>, permite ejecutar un comando en el
<em>router</em> utilizando <code>expect</code>:</p>
<p>```bash</p>
<h1>!/usr/bin/expect -f</h1>
<p>set timeout 20
set username "admin"
set password "admin"
set ip "192.168.1.1"</p>
<h1>Read command as arg to this script</h1>
<p>set cmd [lindex $argv 0]</p>
<p>spawn telnet $ip</p>
<p>expect "Login:"
send -- "<span class="math">\(username\r"
expect "Password:"
send -- "\)</span>password\r"</p>
<p>expect " &gt; "
send -- "$cmd\r"</p>
<p>expect " &gt; "
send -- "^D"
```</p>
<p>Para reiniciarlo, ejecutamos:</p>
<p><code>bash
$ router.sh reboot</code></p>
<p>Para obtener un listado de comandos disponibles, en este caso en un
Comtrend:</p>
<p>```bash
$ router.sh help
spawn telnet 192.168.1.1
Trying 192.168.1.1...
Connected to 192.168.1.1.
Escape character is '^]'.
BCM96328 Broadband Router
Login: admin
Password:</p>
<blockquote>
<p>help
?
help
logout
exit
quit
reboot
adsl
xdslctl
xtm
brctl
cat
loglevel
logdest
virtualserver
ddns
df
dumpcfg
dumpmdm
meminfo
psp
kill
dnsproxy
syslog
echo
ifconfig
ping
ps
pwd
sntp
sysinfo
tftp
wlctl
arp
defaultgateway
dhcpserver
dns
lan
lanhosts
passwd
ppp
restoredefault
route
save
swversion
cfgupdate
swupdate
exitOnIdle
wan
build
version
```</p>
</blockquote>
<h2>Mejorando el <em>script</em></h2>
<p>Un inconveniente es que los datos de conexión, usuario, contraseña e IP,
están escritos directamente en el <em>script</em>. Podemos modificar el
<em>script</em> para que nos pida los datos, o pasárselos como parámetros, pero
si lo hacemos así, prácticamente no ganamos nada respecto a conectarnos
directamente por telnet al <em>router</em>.</p>
<p>Mediante <code>yad</code> (<em>yet another dialog</em>, un <em>fork</em> mejorado de <code>zenity</code>),
crearemos una sencilla interfaz gráfica que nos pida los parámetros
previamente.</p>
<p>Básicamente, consiste en mostrar una pantalla con 3 campos y los botones
de aceptar y cancelar. La IP del <em>router</em> se obtiene de la salida del
comando <code>route</code>. Una vez que se haya reiniciado el <em>router</em>, nos
aparecerá una ventana mostrándonos la nueva IP.</p>
<p><code>bash
action=$(yad
   --title "Router Reboot"
   --image=gnome-shutdown
   --form
   --field=Username
   --field=Password:H
   --field=Gateway
   --separator=" "
   --button="gtk-ok:0"
   --button="gtk-cancel:1"
$username $password $gateway)
ret=$?</code></p>
<p><img alt="Router reboot" src="https://karpoke.ignaciocano.com/images/router-reboot-300x179.png" /></p>
<p>Si le damos a aceptar, la variable <code>$action</code> contendrá el valor de las
variables <code>$username</code>, <code>$password</code> y <code>$gateway</code> separados por un
espacio, y <code>$ret</code> contendrá el valor del botón pulsado, 0 para aceptar y
1 para cancelar.</p>
<p><code>bash
$ echo $action
admin admin 192.168.1.1
$ echo $ret
0</code></p>
<p>Enlace al <em>script</em> <code>router-reboot</code>.</p>
<hr />
<h4>Actualizado el 26 de mayo de 2013</h4>
<p>Ha caído en mis manos el <em>router</em> Comtred VR-3025u de Jazztel, que
permite renovar la IP sin tener que reiniciar el router, por lo que el
cambio es mucho más rápido que esperar a que reinicie.</p>
<p>He encontrado el siguiente <em>script</em> en un <a href="http://bandaancha.eu/foros/script-cambio-ip-comtrend-vr-3025un-1681948" title="foro de Banda Ancha">foro de Banda Ancha</a> para
llevar a cabo la renovación de la IP:</p>
<p>```bash</p>
<h1>!/bin/sh</h1>
<h1>vr3025u</h1>
<p>IFACE=ppp1.1</p>
<h1>vr3025un</h1>
<h1>IFACE=ppp1</h1>
<p>USER=admin
PASS=admin
IP=192.168.1.1</p>
<p>( sleep 3
  echo $USER
  sleep 1
  echo $PASS
  sleep 1
  echo ppp config $IFACE down
  sleep 5
  echo ppp config $IFACE up
  sleep 1
  echo exit ) | telnet $IP
```</p>
<hr />
<h2>Referencias</h2>
<p>» <a href="http://www.cyberciti.biz/tips/shell-script-to-reboot-dsladsl-router.html" title="Shell script to reboot DSL/ADSL router">Shell script to reboot DSL/ADSL router</a>
» <a href="http://code.google.com/p/yad/wiki/Examples" title="yad examples">yad examples</a>
» <a href="http://bandaancha.eu/foros/script-cambio-ip-comtrend-vr-3025un-1681948" title="foro de Banda Ancha">Script cambio IP Comtrend VR-3025un (para JDownloader)</a></p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>


            
            
            






            <hr/>
<section>
    <h2>Entradas relacionadas</h2>
<ul class="related-posts-list">
<li><a href="https://karpoke.ignaciocano.com/2011/06/14/encontrar-los-dominios-que-comparten-ip-con-otro-dado/" title="Encontrar los dominios que comparten IP con otro dado">Encontrar los dominios que comparten IP con otro dado</a></li>
<li><a href="https://karpoke.ignaciocano.com/2011/06/17/conectarse-por-ssh-utilizando-expect/" title="Conectarse por SSH utilizando expect">Conectarse por SSH utilizando expect</a></li>
<li><a href="https://karpoke.ignaciocano.com/2011/08/31/denegacion-de-servicio-en-apache-utilizando-la-cabecera-range/" title="Denegación de servicio en Apache utilizando la cabecera Range">Denegación de servicio en Apache utilizando la cabecera Range</a></li>
<li><a href="https://karpoke.ignaciocano.com/2012/06/04/cambiar-el-firmware-del-router-comtrend-ar-5381u-por-uno-libre/" title="Cambiar el firmware del router Comtrend AR-5381u por uno libre">Cambiar el firmware del router Comtrend AR-5381u por uno libre</a></li>
<li><a href="https://karpoke.ignaciocano.com/2014/05/31/enviar-y-reicibir-notificaciones-de-telegram-desde-la-linea-de-comandos/" title="Enviar y reicibir notificaciones de Telegram desde la línea de comandos">Enviar y reicibir notificaciones de Telegram desde la línea de comandos</a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://karpoke.ignaciocano.com/2012/02/09/instalar-deluge-en-ubuntu-lucid-lynx/" title="Previous: Instalar deluge en Ubuntu Lucid Lynx">Instalar deluge en Ubuntu Lucid Lynx</a></li>
                <li class="next-article"><a href="https://karpoke.ignaciocano.com/2012/02/28/consultar-el-buscon-de-la-rae-desde-el-terminal/" title="Next: Consultar el buscón de la RAE desde el terminal">Consultar el buscón de la RAE desde el terminal</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2012-02-09T21:36:00+01:00">Feb 9, 2012</time>
            <h4>Category</h4>
            <a class="category-link" href="https://karpoke.ignaciocano.com/categorias/#admin-ref">admin</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#comtrend-ref">comtrend
                    <span>2</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#expect-ref">expect
                    <span>3</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#ip-ref">ip
                    <span>3</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#router-ref">router
                    <span>2</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#script-ref">script
                    <span>27</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#telnet-ref">telnet
                    <span>4</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#vr-3025u-ref">vr-3025u
                    <span>1</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#yad-ref">yad
                    <span>1</span>
</a></li>
            </ul>
<h4>Contacto</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/karpoke" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="/feeds/all/rss.xml" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </div>
        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        2010-2019 (cc) Contenido bajo licencia <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/es/">Creative Commons Reconocimiento-CompartirIgual</a>.
    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>