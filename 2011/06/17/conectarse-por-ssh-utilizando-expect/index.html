<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Nacho Cano" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="clave pública, contraseña, expect, ftp, inicio de sesión, openssh, rsa, script, ssh, admin, " />

<meta property="og:title" content="Conectarse por SSH utilizando expect "/>
<meta property="og:url" content="https://karpoke.ignaciocano.com/2011/06/17/conectarse-por-ssh-utilizando-expect/" />
<meta property="og:description" content="expect es un comando que &#34;habla&#34; con otros programas interactivos. Se definen unas reglas en función de lo que esperamos que nos digan esos programas y lo que queremos contestar. Un típico ejemplo es realizar una conexión a un servicio de FTP o SSH, y utilizar expect para que introduzca …" />
<meta property="og:site_name" content="Karpoke" />
<meta property="og:article:author" content="Nacho Cano" />
<meta property="og:article:published_time" content="2011-06-17T14:59:00+02:00" />
<meta name="twitter:title" content="Conectarse por SSH utilizando expect ">
<meta name="twitter:description" content="expect es un comando que &#34;habla&#34; con otros programas interactivos. Se definen unas reglas en función de lo que esperamos que nos digan esos programas y lo que queremos contestar. Un típico ejemplo es realizar una conexión a un servicio de FTP o SSH, y utilizar expect para que introduzca …">

        <title>Conectarse por SSH utilizando expect  · Karpoke
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/admonition.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/custom.css" media="screen">

        <link href="https://karpoke.ignaciocano.com/feeds/all/rss.xml" type="application/rss+xml" rel="alternate" title="Karpoke - Full RSS Feed" />
        <link href="https://karpoke.ignaciocano.com/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Karpoke - RSS Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://karpoke.ignaciocano.com/"><span class=site-name>Karpoke</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://karpoke.ignaciocano.com
                                    >Home</a>
                                </li>
                                <li ><a href="https://karpoke.ignaciocano.com/whoami/">Who am I</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/categorias/">Categories</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/etiquetas/">Tags</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/archivos/">Archives</a></li>
                                <li><form class="navbar-search" action="https://karpoke.ignaciocano.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://karpoke.ignaciocano.com/2011/06/17/conectarse-por-ssh-utilizando-expect/">
                Conectarse por SSH utilizando expect
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p><code>expect</code> es un comando que "habla" con otros programas interactivos. Se
definen unas reglas en función de lo que esperamos que nos digan esos
programas y lo que queremos contestar.</p>
<p>Un típico ejemplo es realizar una conexión a un servicio de FTP o SSH, y
utilizar <code>expect</code> para que introduzca la contraseña por nosotros y lleve
a cabo diferentes acciones. La ventaja que tiene es que podemos
automatizar acciones en esos servicios. El gran inconveniente es que, si
esos servicios requieren autenticación, deberemos escribir la
contraseña, ya sea en un <em>script</em> o directamente en el terminal,
pudiendo quedar reflejada en el historial. (Dependiendo de la
configuración, si incluimos espacios antes de ejecutar un comando, éste
no queda reflejado en el historial).</p>
<h2>Conectarse a un servidor SSH y mostrar una consola interactiva</h2>
<p>Aunque el resultado pueda ser similar a <a href="https://karpoke.ignaciocano.com/2011/03/03/conectarse-por-ssh-solo-usando-la-clave/" title="conectarse por ssh usando sólo la clave">conectarse utilizando la
clave</a>, ya que no nos pedirá contraseña, el nivel de seguridad es muy
diferente, no sólo por lo que ya hemos comentado, sino porque nuestra
contraseña seguramente es más débil que una clave RSA (de al menos 2048
bits). Siempre que sea posible, es preferible utilizar una clave para
conectarnos.</p>
<p>El siguiente <em>script</em> <a href="http://ubuntuforums.org/showpost.php?p=5433300&amp;postcount=5" title="muestra cómo podemos conectarnos">muestra cómo podemos conectarnos</a> utilizando el
usuario y la contraseña escritos en el propio <em>script</em>:</p>
<p>```bash</p>
<h1>!/usr/bin/env expect</h1>
<h1>http://ubuntuforums.org/showpost.php?p=5433300&amp;postcount=5</h1>
<h1>trap sigwinch and pass it to the child we spawned</h1>
<p>trap {
 set rows [stty rows]
 set cols [stty columns]
 stty rows $rows columns $cols &lt; $spawn_out(slave,name)
} WINCH</p>
<p>set username yourUserNameHere
set pass yourPasswordHere
set host theIpAddressToConnectTo</p>
<p>spawn ssh <span class="math">\({username}@\)</span>{host}</p>
<p>expect -re "password:"
send "${pass}\r"</p>
<p>expect -re "$"</p>
<h1>now interact with the session</h1>
<p>interact
```</p>
<p>Podríamos modificar el <em>script</em> para que nos pida los parámetros, y
pasárselos como argumentos desde el terminal. Deberíamos cambiar las
líneas dónde se definen dichas variables por:</p>
<p><code>bash
set username [lrange $argv 0 0]
set pass [lrange $argv 1 1]
set host [lrange $argv 2 2]</code></p>
<p>Y desde el terminal, lo invocaríamos mediante:</p>
<p><code>bash
$ ./sshlogin.ssh username pass host</code></p>
<h2>Conectarse a un servidor SSH, ejecutar un comando y salir</h2>
<p>Otra opción es que nos queramos <a href="http://bash.cyberciti.biz/security/expect-ssh-login-script/" title="conectar para ejecutar un comando">conectar para ejecutar un comando</a>,
ver el resultado y salir. Un sencillo <em>script</em> que nos permite hacer
esto es el siguiente:</p>
<p>```bash</p>
<h1>!/usr/bin/expect -f</h1>
<h1>http://bash.cyberciti.biz/security/expect-ssh-login-script/</h1>
<p>set user [lrange $argv 0 0]
set ip_or_domain [lrange $argv 1 1]
set password [lrange $argv 2 2]
set scriptname [lrange $argv 3 3]
set arg1 [lrange $argv 4 4]
set timeout -1</p>
<h1>now connect to remote UNIX box (ip_or_domain) with given script to execute</h1>
<p>spawn ssh <span class="math">\(user@\)</span>ip_or_domain $scriptname $arg1</p>
<p>match_max 100000</p>
<h1>Look for passwod prompt</h1>
<p>expect "<em>?assword:</em>"</p>
<h1>Send password aka $password</h1>
<p>send -- "$password\r"</p>
<h1>send blank line (\r) to make sure we get back to gui</h1>
<p>send -- "\r"
expect eof
```</p>
<p>Para ejecutarlo:</p>
<p><code>bash
$ ./sshlogin.exp user host pass who</code></p>
<p>La principal diferente entre estos dos <em>scripts</em> es que, después de
enviar la contraseña, uno espera a que se muestre el <em>prompt</em> para
iniciar una sesión interactiva mediante la orden <code>interact</code> y el otro
simplemente cierra la sesión.</p>
<h2>Utilizar <code>expect</code> en el terminal</h2>
<p>También podríamos ejecutar <code>expect</code> directamente en el terminal de la
siguiente manera:</p>
<p><code>bash
$ expect -c "
   set password pass
   spawn ssh user@host who
   match_max 100000
   expect \"_?assword:_\"
   send -- \"${password}\r\"
   send -- \"\r\"
   expect eof
"</code></p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>


            
            
            






            <hr/>
<section>
    <h2>Entradas relacionadas</h2>
<ul class="related-posts-list">
<li><a href="https://karpoke.ignaciocano.com/2011/03/03/conectarse-por-ssh-solo-usando-la-clave/" title="Conectarse por SSH sólo usando la clave">Conectarse por SSH sólo usando la clave</a></li>
<li><a href="https://karpoke.ignaciocano.com/2011/06/14/configurar-apache-para-servir-conexiones-seguras/" title="Configurar Apache para servir conexiones seguras">Configurar Apache para servir conexiones seguras</a></li>
<li><a href="https://karpoke.ignaciocano.com/2011/09/18/fwknop-single-packet-authorization-y-port-knocking/" title="fwknop: Single Packet Authorization y port knocking">fwknop: Single Packet Authorization y port knocking</a></li>
<li><a href="https://karpoke.ignaciocano.com/2012/07/24/conectar-a-un-servidor-ssh-desde-android-mediante-connectbot-utilizando-claves/" title="Conectar a un servidor SSH desde Android mediante ConnectBot utilizando claves">Conectar a un servidor SSH desde Android mediante ConnectBot utilizando claves</a></li>
<li><a href="https://karpoke.ignaciocano.com/2013/06/09/conectarse-por-ssh-utilizando-sshpass/" title="Conectarse por SSH utilizando sshpass">Conectarse por SSH utilizando sshpass</a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://karpoke.ignaciocano.com/2011/06/14/encontrar-los-dominios-que-comparten-ip-con-otro-dado/" title="Previous: Encontrar los dominios que comparten IP con otro dado">Encontrar los dominios que comparten IP con otro dado</a></li>
                <li class="next-article"><a href="https://karpoke.ignaciocano.com/2011/06/17/compartiendo-una-conexion-por-ssh/" title="Next: Compartiendo una conexión por SSH">Compartiendo una conexión por SSH</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2011-06-17T14:59:00+02:00">Jun 17, 2011</time>
            <h4>Category</h4>
            <a class="category-link" href="https://karpoke.ignaciocano.com/categorias/#admin-ref">admin</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#clave-publica-ref">clave pública
                    <span>5</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#contrasena-ref">contraseña
                    <span>4</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#expect-ref">expect
                    <span>3</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#ftp-ref">ftp
                    <span>1</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#inicio-de-sesion-ref">inicio de sesión
                    <span>3</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#openssh-ref">openssh
                    <span>4</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#rsa-ref">rsa
                    <span>5</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#script-ref">script
                    <span>27</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#ssh-ref">ssh
                    <span>24</span>
</a></li>
            </ul>
<h4>Contacto</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/karpoke" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="/feeds/all/rss.xml" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </div>
        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        2010-2019 (cc) Contenido bajo licencia <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/es/">Creative Commons Reconocimiento-CompartirIgual</a>.
    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>