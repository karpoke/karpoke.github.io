<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Nacho Cano" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="2FA, contraseña de un solo uso, OTP, ssh, túnel inverso, verificación en dos pasos, admin, " />

<meta property="og:title" content="Túnel SSH inverso "/>
<meta property="og:url" content="https://karpoke.ignaciocano.com/2011/09/30/tunel-ssh-inverso/" />
<meta property="og:description" content="El escenario es el siguiente. Tenemos un equipo remoto C detrás de un cortafuegos, router o similar, que no podemos configurar y no permite conexiones entrantes, de tal manera que el equipo es inaccesible desde el exterior de la red en la que está. Otro equipo A, el nuestro, también …" />
<meta property="og:site_name" content="Karpoke" />
<meta property="og:article:author" content="Nacho Cano" />
<meta property="og:article:published_time" content="2011-09-30T18:03:00+02:00" />
<meta name="twitter:title" content="Túnel SSH inverso ">
<meta name="twitter:description" content="El escenario es el siguiente. Tenemos un equipo remoto C detrás de un cortafuegos, router o similar, que no podemos configurar y no permite conexiones entrantes, de tal manera que el equipo es inaccesible desde el exterior de la red en la que está. Otro equipo A, el nuestro, también …">

        <title>Túnel SSH inverso  · Karpoke
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/admonition.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://karpoke.ignaciocano.com/theme/css/custom.css" media="screen">

        <link href="https://karpoke.ignaciocano.com/feeds/all/rss.xml" type="application/rss+xml" rel="alternate" title="Karpoke - Full RSS Feed" />
        <link href="https://karpoke.ignaciocano.com/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Karpoke - RSS Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://karpoke.ignaciocano.com/"><span class=site-name>Karpoke</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://karpoke.ignaciocano.com
                                    >Home</a>
                                </li>
                                <li ><a href="https://karpoke.ignaciocano.com/whoami/">Who am I</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/categorias/">Categories</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/etiquetas/">Tags</a></li>
                                <li ><a href="https://karpoke.ignaciocano.com/archivos/">Archives</a></li>
                                <li><form class="navbar-search" action="https://karpoke.ignaciocano.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://karpoke.ignaciocano.com/2011/09/30/tunel-ssh-inverso/">
                Túnel SSH inverso
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>El escenario es el siguiente. Tenemos un equipo remoto C detrás de un
cortafuegos, <em>router</em> o similar, que no podemos configurar y no permite
conexiones entrantes, de tal manera que el equipo es inaccesible desde
el exterior de la red en la que está. Otro equipo A, el nuestro, también
está detrás de un cortafuegos, en otra red, que tampoco podemos
configurar y tampoco permite conexiones entrantes. La buena noticia es
que tenemos un servidor remoto B en otra red diferente al que sí tenemos
acceso por SSH desde el equipo remoto C y desde el nuestro (el A). Tanto
el equipo remoto C como el servidor B tienen un servidor SSH corriendo.</p>
<p>Una posible solución es abrir un túnel inverso del equipo C al servidor
B, entonces desde nuestro equipo (el A) conectarnos al servidor B y de
ahí al equipo remoto C.</p>
<p>El siguiente comando abre un túnel inverso desde el equipo C al servidor
B, de tal manera que en el servidor B en el puerto 8000 se podrá iniciar
una conexión que será redirigida al servidor SSH del equipo C:</p>
<p><code>bash
remoteC$ ssh -f -N -R 8000:localhost:22 userB@remoteB    # remoteC:22    ---&gt;    remoteB:8000
hostA$   ssh userB@remoteB
remoteB$ ssh -p8000 userC@localhost</code></p>
<p>Estas dos últimas acciones se pueden combinar en una sola si utilizamos
el argumento <code>-t</code> para utilizar el servidor SSH de B como servidor
intermedio para acceder a C (a través de la redirección en el propio
servidor B):</p>
<p><code>bash
remoteC$ ssh -f -N -R 8000:localhost:22 userB@remoteB    # remoteC:22    ---&gt;    remoteB:8000
hostA$   ssh -t userB@remoteB ssh -p8000 localhost</code></p>
<p>Otra forma es abrir un túnel desde nuestro equipo creando una
redirección local al puerto del servidor B en el cual se ha creado,
previamente, el túnel inverso al equipo remoto C. De esta forma bastará
conectarnos a nuestro propio equipo para tener acceso al equipo remoto
C:</p>
<p><code>bash
remoteC$ ssh -f -N -R 8000:localhost:22 userB@remoteB    # remoteC:22    ---&gt;    remoteB:8000
hostA$   ssh -f -N -L 8001:localhost:8000 userB@remoteB    # remoteB:8000  ---&gt;    hostA:8001
hostA$   ssh -p8000 userC@localhost</code></p>
<p>Sería mejor que los usuarios para conectarnos al servidor B desde el
equipo remoto C y desde el nuestro fuesen distintos:</p>
<p><code>bash
remoteC$ ssh -f -N -R 8000:localhost:22 user_1B@remoteB  # remoteC:22    ---&gt;    remoteB:8000
hostA$   ssh -f -N -L 8001:localhost:8000 user_2B@remoteB  # hostA:8001    &lt; --    remoteB:8000
hostA$   ssh -p8000 userC@localhost</code></p>
<p>Como último comentario, si vamos a utilizar este sistema para
administrar equipos remotos, quizá sería interesante utilizar algún
sistema de <a href="https://karpoke.ignaciocano.com/2011/08/05/servicio-de-ssh-con-sistema-de-verificacion-en-dos-pasos-de-google-en-ubuntu-natty-narwhal/" title="contraseñas de un solo uso">contraseñas de un solo uso</a> en el servidor.</p>


            
            
            






            <hr/>
<section>
    <h2>Entradas relacionadas</h2>
<ul class="related-posts-list">
<li><a href="https://karpoke.ignaciocano.com/2011/08/05/servicio-de-ssh-con-sistema-de-verificacion-en-dos-pasos-de-google-en-ubuntu-natty-narwhal/" title="Servicio de SSH con sistema de verificación en dos pasos de Google en Ubuntu Natty Narwhal">Servicio de SSH con sistema de verificación en dos pasos de Google en Ubuntu Natty Narwhal</a></li>
<li><a href="https://karpoke.ignaciocano.com/2012/09/30/autenticacion-hardware-mediante-un-usb/" title="Autenticación hardware mediante un USB">Autenticación hardware mediante un USB</a></li>
<li><a href="https://karpoke.ignaciocano.com/2014/12/26/recuperar-el-sistema-tras-borrar-varlib/" title="Recuperar el sistema tras borrar «/var/lib»">Recuperar el sistema tras borrar «/var/lib»</a></li>
<li><a href="https://karpoke.ignaciocano.com/2015/03/22/servicio-de-ssh-con-latch-en-ubuntu/" title="Servicio de SSH con Latch en Ubuntu">Servicio de SSH con Latch en Ubuntu</a></li>
<li><a href="https://karpoke.ignaciocano.com/2016/11/06/streisand-una-herramienta-que-permite-evadir-la-censura-de-gobiernos-y-isp-de-forma-facil/" title="Streisand: Una herramienta que permite evadir la censura de Gobiernos y ISP de forma fácil">Streisand: Una herramienta que permite evadir la censura de Gobiernos y ISP de forma fácil</a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://karpoke.ignaciocano.com/2011/09/30/encuentra-el-hash/" title="Previous: Encuentra el hash">Encuentra el hash</a></li>
                <li class="next-article"><a href="https://karpoke.ignaciocano.com/2011/10/01/el-consumo-de-la-bateria/" title="Next: El consumo de la batería">El consumo de la batería</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2011-09-30T18:03:00+02:00">Sep 30, 2011</time>
            <h4>Category</h4>
            <a class="category-link" href="https://karpoke.ignaciocano.com/categorias/#admin-ref">admin</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#2fa-ref">2FA
                    <span>4</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#contrasena-de-un-solo-uso-ref">contraseña de un solo uso
                    <span>2</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#otp-ref">OTP
                    <span>3</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#ssh-ref">ssh
                    <span>24</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#tunel-inverso-ref">túnel inverso
                    <span>1</span>
</a></li>
                <li><a href="https://karpoke.ignaciocano.com/etiquetas/#verificacion-en-dos-pasos-ref">verificación en dos pasos
                    <span>3</span>
</a></li>
            </ul>
<h4>Contacto</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/karpoke" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="/feeds/all/rss.xml" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </div>
        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        2010-2019 (cc) Contenido bajo licencia <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/es/">Creative Commons Reconocimiento-CompartirIgual</a>.
    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>